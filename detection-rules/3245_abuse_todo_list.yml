name: "PR# 3245 - Task management impersonation: Utilizing SendGrid infrastructure"
description: "Detects messages impersonating task or productivity applications by using 'todo list' or 'reminder list' in the subject line while utilizing SendGrid infrastructure. The sender claims to be task-related through display name or body content but originates from non-legitimate domains without proper DMARC authentication."
type: "rule"
severity: "high"
source: |
  type.inbound
  //subject contains "todo list"
  and (
    regex.icontains(subject.subject, "T[0o] D[o0] L[I1l]ST")
    or (
      strings.icontains(subject.subject, "todo")
      and strings.icontains(subject.subject, "list")
    )
    or (
      strings.icontains(subject.subject, "reminder")
      and strings.icontains(subject.subject, "list")
    )
  )
  // utilizing sendgrid infra
  and strings.icontains(headers.return_path.domain.root_domain, "sendgrid")
  and (
    // and sender claims to be task/productivity related but domain doesn't match
    (
      regex.icontains(headers.from.display_name, "(task|todo|gtask|reminder)")
      or regex.icontains(body.current_thread.text,
                         "(waiting for review|new task.*added|[0-9]+ of [0-9]+ tasks? completed)"
      )
    )
    // not from legitimate or internal domains (unless DMARC fails)
    and not (
      sender.email.domain.root_domain in $org_domains
      and headers.auth_summary.dmarc.pass
    )
  )

attack_types:
  - "Credential Phishing"
tactics_and_techniques:
  - "Impersonation: Brand"
  - "Social engineering"
  - "Evasion"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Sender analysis"
id: "4f3ed61b-06b1-5b1b-8f12-deedc2c8ee94"
tags:
  - created_from_open_prs
  - rule_status_added
  - pr_author_IndiaAce
references:
  - https://github.com/sublime-security/sublime-rules/pull/3245