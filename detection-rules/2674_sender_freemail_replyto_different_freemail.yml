name: "PR# 2674 - Free Email Provider Sender with Mismatched Provider Reply-To"
description: "Detects when a sender using a free email provider includes a reply-to address from a different free email provider, which is a common social engineering tactic."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and sender.email.domain.root_domain in $free_email_providers
  and length(headers.reply_to) > 0
  and any(headers.reply_to,
          .email.domain.root_domain in $free_email_providers
          and .email.domain.root_domain != sender.email.domain.root_domain
          and .email.domain.root_domain not in ("googlegroups.com")
  )
  // secureserver.net seems to rewrite the sender local part to be the reply-to domain
  // observed in many newsletter send via secureserver.net
  and not (
    sender.email.domain.domain == 'bounces.cloud.em.secureserver.net'
    and all(headers.reply_to,
            strings.istarts_with(sender.email.local_part, .email.local_part)
            and strings.iends_with(sender.email.local_part, .email.domain.domain)
    )
  )
attack_types:
  - "BEC/Fraud"
  - "Credential Phishing"
tactics_and_techniques:
  - "Free email provider"
  - "Social engineering"
detection_methods:
  - "Header analysis"
  - "Sender analysis"
id: "8b9eddbe-2ed3-5bb0-9b13-75cb721b5337"
tags:
  - created_from_open_prs
  - rule_status_added
  - pr_author_zoomequipd
references:
  - https://github.com/sublime-security/sublime-rules/pull/2674