name: "PR# 3064 - Attachment: SVG file execution"
description: |
  Detects file execution attempts in SVG files. ActiveXObject is used to invoke WScript.Shell and run a program.
references:
  - "https://delivr.to/payloads?id=511ae995-5401-4c60-ae50-08a5b12b3f4b"
  - https://github.com/sublime-security/sublime-rules/pull/3064
type: "rule"
severity: "high"
source: |
  type.inbound
  and any(attachments,
          (
            .file_extension =~ "svg"
            or .file_extension in $file_extensions_common_archives
            or .file_type == "svg"
          )
          and any(file.explode(.),
                  .file_extension == "svg"
                  // Author Matt harr0ey @harr0ey
                  // Topic: SVG file Execution
                  // WScript inside SVG
                  // <script language="JScript">
                  // <![CDATA[
                  // var r = new ActiveXObject("WScript.Shell").Run("calc.exe")
                  // ]]>
                  // </script>
                  and any(.scan.strings.strings,
                          strings.icontains(., "ActiveXObject")
                  )
                  and any(.scan.strings.strings,
                          strings.icontains(., "WScript.Shell")
                  )
                  and any(.scan.strings.strings,
                          strings.like(., "*Run*", "*Execute*")
                  )
          )
  )
attack_types:
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Scripting"
detection_methods:
  - "Archive analysis"
  - "Content analysis"
  - "File analysis"
id: "fe3c7f96-7f97-5290-b8df-c99bc45e3ed5"
tags:
  - created_from_open_prs
  - rule_status_modified
  - pr_author_markmsublime