name: "PR# 3647 - Link: Shell installer script with terminal references"
description: "Detects messages containing links to shell installer scripts (ending in 'installer.sh') combined with terminal-related content in the message body, indicating potential malicious software installation instructions."
type: "rule"
severity: "medium"
source: |
  type.inbound // Link to a file to download/execute
  and any(filter(body.links, length(body.links) > 0),
          any(["setup", "deploy", "launch", "run", "install", "installer"],
              strings.icontains(..href_url.path, .)
          )
          and regex.contains(.href_url.path,
                             ".(sh|exe|msi|ps1|pkg|dmg|deb|rpm|scr|bat|cmd|bin)"
          )
  )
  and any([
            "bash",
            "sh",
            "zsh",
            "powershell",
            "pwsh",
            "Invoke-WebRequest",
            "Invoke-RestMethod",
            "Start-BitsTransfer",
            "Invoke-Expression",
            "DownloadString",
            "DownloadFile",
            "-EncodedCommand",
            "python",
            "curl",
            "wget",
            "IEX(",
            "iwr",
            "chmod +x",
            "bitsadmin",
            "certutil",
            "mshta",
            "wscript",
            "cscript",
            "msiexec",
            "rundll32",
            "regsvr32",
            "ftp",
            "sftp",
            "tftp",
            "wsl curl",
            "npm install",
            "pip install",
            "brew install",
            "docker pull"
          ],
          strings.icontains(body.html.raw, .)
  )
tags:
  - "Attack surface reduction"
  - pr_author_MSAdministrator
  - created_from_open_prs
  - rule_status_added
attack_types:
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Social engineering"
  - "Scripting"
detection_methods:
  - "Content analysis"
  - "URL analysis"
id: "771047e7-f47f-5a30-be34-207e0cc9bf7c"
references:
  - https://github.com/sublime-security/sublime-rules/pull/3647