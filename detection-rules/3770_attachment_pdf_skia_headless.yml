name: "PR# 3770 - Attachment: PDF with suspicious HeadlessChrome metadata"
description: "Detects PDF attachments created by HeadlessChrome with suspicious characteristics, including MD5-formatted HTML filenames or blank titles with Windows Skia/PDF producer, excluding legitimate Google Docs files."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and any(filter(attachments, .file_extension == "pdf"),
          (
            strings.icontains(beta.parse_exif(.).creator, "HeadlessChrome")
            or strings.icontains(beta.parse_exif(.).creator, "Chromium")
          )
          and beta.parse_exif(.).page_count == 1
          and (
            // MD5 filename, 32 hex chars and .html
            regex.imatch(beta.parse_exif(.).title, '^[a-f0-9]{32}\.html$')
            or (
              strings.istarts_with(.file_name, "bill")
              or strings.istarts_with(.file_name, "lnv")
              or strings.istarts_with(.file_name, "inv")
              or regex.contains(.file_name, '^(\d{3}|\w{1})[A-Z0-9]+(.pdf)')
            )
            or 
            // about:blank and Windows HeadlessChrome 
            (
              beta.parse_exif(.).title == "about:blank"
              and strings.istarts_with(beta.parse_exif(.).producer, "Skia/PDF")
              and (
                strings.icontains(beta.parse_exif(.).creator, "Windows")
                or strings.icontains(beta.parse_exif(.).creator, "Chromium")
              )
            )
            and not strings.icontains(beta.parse_exif(.).producer, "Google Docs")
          )
          and not (
            sender.email.domain.root_domain in (
              "guardtek.net",
              "gominis.com",
              "aglgroup.com",
              "truckerzoom.com"
            )
            and coalesce(headers.auth_summary.dmarc.pass, false)
          )
  )
tags:
  - pr_author_MSAdministrator
  - created_from_open_prs
  - rule_status_modified
- "Attack surface reduction"
attack_types:
  - "Credential Phishing"
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Evasion"
  - "PDF"
detection_methods:
  - "File analysis"
  - "Exif analysis"
id: "3ede5d9f-813e-595b-a9c9-cdb3b6640f58"
references:
  - https://github.com/sublime-security/sublime-rules/pull/3770