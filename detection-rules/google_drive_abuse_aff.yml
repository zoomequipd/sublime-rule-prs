name: "Google Drive abuse: Advance Fee Fraud (AFF) via comment tagging"
description: "Attackers abuse Google Drive and its commenting feature by creating a document with Advance Fee Fraud (AFF) verbiage, and then tagging potential victims in the comments, thereby sending an email to the intended target."
type: "rule"
severity: "medium"
source: |
  type.inbound
  and regex.contains(sender.display_name, '\(Google (Slides|Docs)')
  and 1 of (
    strings.ilike(body.plain.raw, '*you have ? hours*'),
    strings.ilike(body.plain.raw, '*transfer of funds*'),
    strings.ilike(body.plain.raw, '*order your funds*')
    // or the sender's display name is not in your org Display Names
    or not any($org_display_names,
               strings.istarts_with(sender.display_name,
                                    strings.concat(., " (Google ")
               )
    )
  )
  and any(body.links,
          .href_url.domain.domain in ("docs.google.com", "slides.google.com")
          and strings.ilike(.href_url.query_params, "*comment_email*")
  )
  // document author's email address is a freemail address
  and any(headers.hops,
          .index == 0
          and any(.fields,
                  .name == "X-EditorsNotification-MentionAuthor"
                  and any($free_email_providers, strings.iends_with(..value, .))
          )
  )

attack_types:
  - "BEC/Fraud"
tactics_and_techniques:
  - "Free email provider"
  - "Free file host"
  - "Impersonation: Brand"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Sender analysis"
  - "URL analysis"
id: "300ffabb-ac27-58e5-a53f-c95ed3a1c7a9"
tags:
  - pr_author_aidenmitchell