name: "PR# 3565 - Spam: Unsolicited WordPress account creation or password reset request"
description: "Detects messages containing WordPress password reset links where the login parameter does not match the recipient's email address. The rule triggers for unsolicited senders, previously malicious senders, or when DMARC authentication fails."
type: "rule"
severity: "low"
source: |
  type.inbound
  and body.html.raw is null
  and any(body.links,
          .href_url.path == "/wp-login.php"
          and any(.href_url.query_params_decoded["key"], . is not null)
          and any(.href_url.query_params_decoded["login"],
                  any(recipients.to,
                      .email.local_part != .. and .email.email != ..
                  )
          )
  )
  and (
    (
      not profile.by_sender().solicited
      and profile.by_sender().prevalence == "new"
    )
    or (
      profile.by_sender().any_messages_malicious_or_spam
      and not profile.by_sender().any_messages_benign
    )
    or not headers.auth_summary.dmarc.pass
  )
tags:
  - "Attack surface reduction"
  - pr_author_aidenmitchell
  - created_from_open_prs
  - rule_status_added
attack_types:
  - "Spam"
tactics_and_techniques:
  - "Social engineering"
detection_methods:
  - "Header analysis"
  - "Sender analysis"
  - "URL analysis"
id: "799ba564-c98e-54e0-a127-dad9035014c2"
references:
  - https://github.com/sublime-security/sublime-rules/pull/3565