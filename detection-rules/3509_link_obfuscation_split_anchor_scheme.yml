name: "PR# 3509 - Link: URL scheme obfuscation via split HTML anchors"
description: |
  Detects URLs intentionally split across multiple adjacent HTML anchor tags to evade URL analysis and detection systems.
  This sophisticated evasion technique breaks the URL scheme (http/https) across separate anchor elements,
  rendering as: <a>h</a><a>ttp://malicious.com</a>

  The technique bypasses many security tools that expect complete, well-formed URLs while displaying a
  seemingly normal link to end users. This pattern is strongly associated with credential phishing and
  compromised email accounts.

  References:
  - Observed in wild credential phishing campaigns (2024-2025)
  - Evades traditional URL extraction and analysis tools
type: "rule"
severity: "high"
source: |
  type.inbound
  and length(body.current_thread.links) == 2
  and length(filter(html.xpath(body.html, "//a").nodes,
        .display_text == "h"
        and any(.links, .href_url.scheme in ("http", "https"))
  )) == 1
  and length(filter(html.xpath(body.html, "//a").nodes,
        (
          strings.starts_with(.display_text, "ttp://")
          or strings.starts_with(.display_text, "ttps://")
        )
        and any(.links, .href_url.scheme in ("http", "https"))
  )) == 1

tags:
  - "Attack surface reduction"
  - pr_author_MSAdministrator
  - created_from_open_prs
  - rule_status_added
attack_types:
  - "Credential Phishing"
  - "BEC/Fraud"
tactics_and_techniques:
  - "Evasion"
  - "HTML injection"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "HTML analysis"
  - "URL analysis"
id: "75de341b-f091-56d0-9bc9-f7d3caec4f1f"
references:
  - https://github.com/sublime-security/sublime-rules/pull/3509