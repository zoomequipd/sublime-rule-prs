name: "PR# 3339 - Spam: Website errors solicitation"
description: "This rule detects messages claiming to have identified errors on a website. The messages typically offer to send pricing or information upon request."
type: "rule"
severity: "low"
source: |
  type.inbound
  and (
    sender.email.email not in $recipient_emails
    or not profile.by_sender().solicited
  )
  and 1 of (
      // Single thread message groups
    (
      length(attachments) == 0
      and length(body.links) == 0
      and length(body.previous_threads) == 0
      and 20 < length(body.current_thread.text) < 500
      and regex.icontains(body.current_thread.text, "screenshot")
      and regex.icontains(body.current_thread.text, '.*(hi|hello|hey)')
      and regex.icontains(body.current_thread.text, ".*(error|report|issues)")
      and regex.icontains(subject.subject, ".*(proposal|cost|report|error|audit|screenshot)")
    ),
    // Single thread message groups but with 1 unsubscribe link
    (
      length(attachments) == 0
      and length(body.links) == 1
      and regex.icontains(body.html.raw, "mailto:*[++unsubscribe@]")
      and length(body.previous_threads) == 0
      and 20 < length(body.current_thread.text) < 500
      and regex.icontains(body.current_thread.text, "screenshot")
      and regex.icontains(body.current_thread.text, '.*(hi|hello|hey)')
      and regex.icontains(body.current_thread.text, ".*(error|report|issues)")
      and regex.icontains(subject.subject, ".*(proposal|cost|report|error|audit|screenshot)")
    ),
    // Multiple thread message groups
    (
      length(attachments) == 0
      and length(body.links) == 0
      and length(body.previous_threads) < 5
      and regex.icontains(subject.subject, ".*(proposal|cost|report|error|audit)")
      and any(body.previous_threads,
              length(.text) < 400
              and regex.icontains(.text, '.*(hey|hi|hello)')
              and regex.icontains(.text, ".*(error|screenshot|report)")
              and strings.count(.text, "?") >= 3
              and ml.nlu_classifier(.text).language == "english"
      )
    )
  )

tags:
  - "Attack surface reduction"
  - pr_author_MSAdministrator
  - created_from_open_prs
  - rule_status_added
attack_types:
  - "Spam"
detection_methods:
  - "Content analysis"
  - "Sender analysis"
  - "Natural Language Understanding"
id: "d2be22f6-3fab-542f-8ce2-c3f583d5fff4"
references:
  - https://github.com/sublime-security/sublime-rules/pull/3339